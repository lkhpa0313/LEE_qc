<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Tpu Tube 일일 생산 일지</title>
  <link href="https://fonts.googleapis.com/css2?family=Anton&display=swap" rel="stylesheet">
  <style>
    body { background:black; color:white; font-family:Segoe UI, sans-serif; margin:0; padding:0; }
    header {
      background-color: black;
      color: white;
      padding: 1em;
      text-align: center;
      font-size: 3em;
      font-family: 'Anton', sans-serif; 
      letter-spacing: 2px;
    }
    .menu {
      width: 98%;
      margin: 0 auto;
      display: grid;
      grid-template-columns: repeat(9, 1fr);
      background-color: black;
      text-align: center;
      align-items: center;
      border: 3px solid red;
      border-radius: 5px;
    }
    .menu-item { position: relative; }
    .menu button {
      background-color: black;
      border: none;
      color: white;
      padding: 1em 0;
      cursor: pointer;
      font-size: 1em;
      font-weight: bold;
      width: 100%;
    }
    .menu button:hover { color: #ff3c57; }
    .submenu {
      display: none;
      position: absolute;
      top: 100%;
      left: 50%;
      transform: translateX(-50%);
      background-color: #000;
      box-shadow: 0 2px 10px rgba(255, 255, 255, 0.15);
      z-index: 100;
      width: 160px;
    }
    .submenu ul { list-style: none; margin: 0; padding: 0; }
    .submenu li {
      text-align: center;
      font-size: 1em;
      padding: 0.8em;
      border-bottom: 1px solid #222;
    }
    .submenu li a {
      color: #fff;
      text-decoration: none;
      display: block;
    }
    .submenu li a:hover { color: #ff3c57; }
    .menu-item:hover .submenu { display: block; }
    main { padding: 20px; }
    table {
      width: 100%;
      background: white;
      color: black;
      text-align: center;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid black;
      padding: 6px;
    }
    input[type="text"], input[type="date"] {
      width: 100%;
      height: 25px;
      box-sizing: border-box;
    }
    .register-button {
      background-color: #ff3c57;
      color: white;
      padding: 0.5em 1.5em;
      border: none;
      border-radius: 7px;
      font-size: 1em;
      font-weight: bold;
      margin-top: 20px;
      cursor: pointer;
    }
    .register-button:hover { background-color: #e22e4d; }
    .footer {
      text-align: center;
      font-size: 0.9em;
      color: #aaa;
      background-color: #1a1a1a;
      padding: 1em 0;
      margin-top: auto;
    }
  </style>
</head>
<body>
  <header>Production Management System</header>
  <nav class="menu">
    <div class="menu-item"><button>NoticeBoard</button><div class="submenu"><ul><li><a href="#">공지사항</a></li><li><a href="#">문의게시판</a></li></ul></div></div>
    <div class="menu-item"><button>Tire</button><div class="submenu"><ul><li><a href="#">생산 계획</a></li><li><a href="#">작업 지시서</a></li></ul></div></div>
    <div class="menu-item"><button>Armour</button><div class="submenu"><ul><li><a href="#">생산 계획</a></li></ul></div></div>
    <div class="menu-item"><button>Tubeless</button><div class="submenu"><ul><li><a href="#">생산 일지</a></li></ul></div></div>
    <div class="menu-item"><button>Oofos</button><div class="submenu"><ul><li><a href="#">포장 일지</a></li></ul></div></div>
    <div class="menu-item"><button>QuanFoam</button><div class="submenu"><ul><li><a href="#">생산 일지</a></li></ul></div></div>
    <div class="menu-item"><button>Compound</button><div class="submenu"><ul><li><a href="#">생산 일지</a></li></ul></div></div>
    <div class="menu-item"><button>TpuTube</button><div class="submenu"><ul><li><a href="#">포장 현황</a></li></ul></div></div>
    <div class="menu-item"><button>QC</button>
      <div class="submenu">
        <ul>
          <li><a href="qcdata.html">Data</a></li>
          <li><a href="tire.html">Tire</a></li>
          <li><a href="amour.html">Armour</a></li>
          <li><a href="tubeless.html">Tubeless</a></li>
          <li><a href="oofos.html">Oofos</a></li>
          <li><a href="quanfoam.html">QuanFoam</a></li>
          <li><a href="compound.html">Compound</a></li>
          <li><a href="tpu.html">Tpu</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <main>
    <h2 style="text-align:center;">Tpu Tube 일일 생산 입력</h2>
    <div style="display: flex; justify-content: center; gap: 30px; margin-top: 30px;">
      <div>
        <label>작성자</label><br>
        <input type="text" id="authorInput" placeholder="이름 입력">
      </div>
      <div>
        <label>작성일</label><br>
        <input type="date" id="dateInput">
      </div>
    </div>

    <table>
      <thead>
        <tr>
          <th>Date</th>
          <th>Production Quantity</th>
          <th>Product</th>
          <th>Valve Defect</th>
          <th>Welding Defect</th>
          <th>24h Inspection Defect</th>
          <th>Defective Quantity</th>
          <th>Completion Quantity</th>
          <th>Delete</th>
        </tr>
      </thead>
      
      <tbody id="data-body">
        
      </tbody>
    </table>

    <div style="text-align:center;">
      <button class="register-button" onclick="registerCompoundLog()">등록</button>
    </div>
  </main>

  <footer class="footer">
    <p>담당자 : 김준태 팀장 | 연락처 : 010-8790-0309 | email : jtkim@tannus.com</p>
  </footer>

  <script>
  function registerCompoundLog() {
    const selectedDate = document.getElementById('dateInput').value || new Date().toISOString().split('T')[0];
    const currentDate = new Date().toISOString().split('T')[0];
    const author = document.getElementById('authorInput').value || '미입력';

    const rows = document.querySelectorAll('#data-body tr');

    const logs = Array.from(rows).map(row => {
      const inputs = row.querySelectorAll('input');
      return {
        date: selectedDate,
        ProductionQuantity: inputs[1].value,
        product: inputs[2].value,
        ValveDefect: inputs[3].value,
        WeldingDefect: inputs[4].value,
        InspectionDefect: inputs[5].value,
        DefectiveQuantity: inputs[6].value,
        CompletionQuantity: inputs[7].value,
        author: author,
        title: `${selectedDate} TPU tube 일일생산일지`,
        createdAt: currentDate
      };
    });

    fetch("http://localhost:8080/api/tpu/save-multiple", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      credentials: 'include',
      body: JSON.stringify(logs)
    })
    .then(response => {
      if (!response.ok) throw new Error("서버 오류");
      return response.text();
    })
    .then(data => {
      alert("저장 완료: " + data);
      window.location.href = 'tpu.html';
    })
    .catch(err => {
      alert("저장 실패: " + err.message);
    });
  }

  function createRow() {
  const row = document.createElement('tr');
  const fields = ['date', 'text', 'text', 'text', 'text', 'text', 'text', 'text', 'text'];

  fields.forEach((type, index) => {
    const td = document.createElement('td');
    const input = document.createElement('input');
    input.type = type;

    if (index === 0) {
      input.classList.add('date-cell');
    }

    input.style.width = '100%';
    td.appendChild(input);
    row.appendChild(td);
  });

  // 삭제 버튼
  const deleteTd = document.createElement('td');
  const deleteBtn = document.createElement('button');
  deleteBtn.textContent = '삭제';
  deleteBtn.onclick = () => row.remove();
  deleteTd.appendChild(deleteBtn);
  row.appendChild(deleteTd);

  document.getElementById('data-body').appendChild(row);
  attachModulusListener(row);  // ✅ 항상 붙이기
  hideDateCells();

  return row;
}


  function isRowComplete(row) {
    const inputs = row.querySelectorAll('td input:not(.date-cell)');
    return Array.from(inputs).every(input => input.value.trim() !== '');
  }

  function attachModulusListener(row) {
    const inputs = row.querySelectorAll('input');
    const modulusInput = inputs[8];
    if (!modulusInput) return;

    modulusInput.addEventListener('keydown', function (e) {
      if ((e.key === 'Enter' || e.key === 'Tab') && isRowComplete(row)) {
        setTimeout(() => createRow(), 100);
      }
    });
  }

  function hideDateCells() {
    const dateInputs = document.querySelectorAll('.date-cell');
    dateInputs.forEach((input, idx) => {
      input.style.visibility = idx === 0 ? 'visible' : 'hidden';
    });
  }

  // ✅ 페이지 로드 시 첫 행 자동 추가
  window.onload = () => {
    document.getElementById('dateInput').value = new Date().toISOString().split('T')[0];
    createRow();
  };
</script>


</body>
</html>